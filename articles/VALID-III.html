<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to the **Expectations in Unit Tests** Workflow (**VALID-III**) • pointblank</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the **Expectations in Unit Tests** Workflow (**VALID-III**)">
<meta property="og:description" content="pointblank">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pointblank</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Development version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Validation Workflows</li>
    <li>
      <a href="../articles/validation_workflows.html">Overview</a>
    </li>
    <li>
      <a href="../articles/VALID-I.html">VALID-I: Data Quality Reporting</a>
    </li>
    <li>
      <a href="../articles/VALID-II.html">VALID-II: Pipeline Data Validation</a>
    </li>
    <li>
      <a href="../articles/VALID-III.html">VALID-III: Expectations in Unit Tests</a>
    </li>
    <li>
      <a href="../articles/VALID-IV.html">VALID-IV: Data Tests for Conditionals</a>
    </li>
    <li>
      <a href="../articles/VALID-V.html">VALID-V: Table Scan</a>
    </li>
    <li>
      <a href="../articles/VALID-VI.html">VALID-VI: R Markdown Document Validation</a>
    </li>
    <li class="dropdown-header">Information Management</li>
    <li>
      <a href="../articles/INFO-1.html">Intro to Information Management</a>
    </li>
    <li>
      <a href="../articles/INFO-2.html">Advanced Information Management</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rich-iannone/pointblank/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="VALID-III_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to the <strong>Expectations in Unit Tests</strong> Workflow (<strong>VALID-III</strong>)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rich-iannone/pointblank/blob/HEAD/vignettes/VALID-III.Rmd" class="external-link"><code>vignettes/VALID-III.Rmd</code></a></small>
      <div class="hidden name"><code>VALID-III.Rmd</code></div>

    </div>

    
    
<p><img src="images/VALID-III.svg" width="100%"></p>
<p>The <em>VALID-III: Expectations in Unit Tests</em> workflow is all about checking your data alongside your usual <strong>testthat</strong> tests. The functions used for this workflow all begin with the <code>expect_</code> prefix and are based on the set of validation functions used in the <a href="../articles/VALID-I.html"><strong>VALID-I</strong></a> and <a href="../articles/VALID-II.html"><strong>VALID-II</strong></a> workflows. Here’s the complete list of functions with a phrase for each function’s expectation:</p>
<ul>
<li>
<code><a href="../reference/col_vals_lt.html">expect_col_vals_lt()</a></code>: Expect that column data are less than a specified value.</li>
<li>
<code><a href="../reference/col_vals_lte.html">expect_col_vals_lte()</a></code>: Expect that column data are less than or equal to a specified value.</li>
<li>
<code><a href="../reference/col_vals_equal.html">expect_col_vals_equal()</a></code>: Expect that column data are equal to a specified value.</li>
<li>
<code><a href="../reference/col_vals_not_equal.html">expect_col_vals_not_equal()</a></code>: Expect that column data are not equal to a specified value.</li>
<li>
<code><a href="../reference/col_vals_gte.html">expect_col_vals_gte()</a></code>: Expect that column data are greater than or equal to a specified value.</li>
<li>
<code><a href="../reference/col_vals_gt.html">expect_col_vals_gt()</a></code>: Expect that column data are greater than a specified value.</li>
<li>
<code><a href="../reference/col_vals_between.html">expect_col_vals_between()</a></code>: Expect that column data are between two specified values.</li>
<li>
<code><a href="../reference/col_vals_not_between.html">expect_col_vals_not_between()</a></code>: Expect that column data are not between two specified values.</li>
<li>
<code><a href="../reference/col_vals_in_set.html">expect_col_vals_in_set()</a></code>: Expect that column data are part of a specified set of values.</li>
<li>
<code><a href="../reference/col_vals_not_in_set.html">expect_col_vals_not_in_set()</a></code>: Expect that column data are not part of a specified set of values.</li>
<li>
<code><a href="../reference/col_vals_null.html">expect_col_vals_null()</a></code>: Expect that column data are <code>NULL</code>/<code>NA</code>.</li>
<li>
<code><a href="../reference/col_vals_not_null.html">expect_col_vals_not_null()</a></code>: Expect that column data are not <code>NULL</code>/<code>NA</code>.</li>
<li>
<code><a href="../reference/col_vals_regex.html">expect_col_vals_regex()</a></code>: Expect that strings in column data match a regex pattern.</li>
<li>
<code><a href="../reference/col_vals_expr.html">expect_col_vals_expr()</a></code>: Expect that column data agree with a predicate expression.</li>
<li>
<code><a href="../reference/conjointly.html">expect_conjointly()</a></code>: Expect that multiple rowwise validations result in joint validity.</li>
<li>
<code><a href="../reference/rows_distinct.html">expect_rows_distinct()</a></code>: Expect that row data are distinct.</li>
<li>
<code><a href="../reference/col_is_character.html">expect_col_is_character()</a></code>: Expect that the columns contain character/string data.</li>
<li>
<code><a href="../reference/col_is_numeric.html">expect_col_is_numeric()</a></code>: Expect that the columns contain numeric values.</li>
<li>
<code><a href="../reference/col_is_integer.html">expect_col_is_integer()</a></code>: Expect that the columns contain integer values.</li>
<li>
<code><a href="../reference/col_is_logical.html">expect_col_is_logical()</a></code>: Expect that the columns contain logical values.</li>
<li>
<code><a href="../reference/col_is_date.html">expect_col_is_date()</a></code>: Expect that the columns contain R <code>Date</code> objects.</li>
<li>
<code><a href="../reference/col_is_posix.html">expect_col_is_posix()</a></code>: Expect that the columns contain <code>POSIXct</code> dates.</li>
<li>
<code><a href="../reference/col_is_factor.html">expect_col_is_factor()</a></code>: Expect that the columns contain R <code>factor</code> objects.</li>
<li>
<code><a href="../reference/col_exists.html">expect_col_exists()</a></code>: Expect that one or more columns actually exist.</li>
<li>
<code><a href="../reference/col_schema_match.html">expect_col_schema_match()</a></code>: Expect that columns in the table (and their types) match a predefined schema.</li>
</ul>
<p>Now that we know that the functions are similar in intent but different in name, let’s learn how to use these functions effectively.</p>
<div class="section level1">
<h1 id="using-expect_-functions-in-the-testthat-way">Using <code>expect_*()</code> Functions in the <strong>testthat</strong> Way<a class="anchor" aria-label="anchor" href="#using-expect_-functions-in-the-testthat-way"></a>
</h1>
<p>The <strong>testthat</strong> package has collection of functions that begin with <code>expect_</code>. It’s no coincidence that the <strong>pointblank</strong> for the <strong>VALID-III</strong> workflow adopts the same naming convention. The idea is to use these functions interchangeably with those from <strong>testthat</strong> in the standard <strong>testthat</strong> workflow (in a <code>test-&lt;name&gt;.R</code> file, inside the <code>tests/testthat</code> folder). The big difference here is that instead of testing function outputs, we are testing data tables. However, tables may be returned from function calls and the <code>expect_*()</code> functions offered up by <strong>pointblank</strong> might offer more flexibility for testing that data. For instance <code><a href="../reference/col_vals_between.html">expect_col_vals_between()</a></code> allows us to write an expectation with fine control on boundary values (and whether they are inclusive bounds), whether <code>NA</code> values should be ignored, and we can even set a failure threshold if that makes sense for the expectation.</p>
<p>Here’s an example of how to generate some tests on data with <strong>testthat</strong> and also with <strong>pointblank</strong>. For the <code>small_table</code> dataset, let’s write expectations that show that non-NA values in column <code>c</code> are between <code>2</code> and <code>9</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">small_table</span><span class="op">$</span><span class="va">c</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">small_table</span><span class="op">$</span><span class="va">c</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>There is no <strong>testthat</strong> function that tests for values between two values. The original strategy was to use <code><a href="https://testthat.r-lib.org/reference/comparison-expectations.html" class="external-link">testthat::expect_gte()</a></code> and <code>testthat::lte()</code> with <code>small_table$c</code> as the <code>object</code> in both, however, that doesn’t work because that results in a logical vector greater than length 1. Also, there is no allowance for <code>NA</code> values to be skipped. The best I could do was the above.</p>
<p>The <strong>pointblank</strong> version of this task makes for a more succinct and understandable expectation expression:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/col_vals_between.html">expect_col_vals_between</a></span><span class="op">(</span><span class="va">small_table</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">c</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">9</span>, na_pass <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The arguments in the <code><a href="../reference/col_vals_between.html">expect_col_vals_between()</a></code> give us everything we need to check tabular data without having to do subsetting and perform other transformations. There are a few added benefits. Should data come from a data source other than locals data frame, the SQL expressions are handled internally and they have been tested extensively across the supported database types and in Spark DataFrames as well.</p>
</div>
<div class="section level1">
<h1 id="these-expect_-functions-are-simpler-than-their-counterparts">These <code>expect_*()</code> Functions Are Simpler Than Their Counterparts<a class="anchor" aria-label="anchor" href="#these-expect_-functions-are-simpler-than-their-counterparts"></a>
</h1>
<p>All of the <code>expect_*()</code> functions have the same leading arguments of their validation function counterparts but they omit the following arguments at the end of their signatures:</p>
<ul>
<li><code>actions</code></li>
<li><code>step_id</code></li>
<li><code>label</code></li>
<li><code>brief</code></li>
<li><code>active</code></li>
</ul>
<p>While we lose the <code>actions</code> argument, we get in its place the <code>threshold</code> argument. This is a simple failure threshold value for use with the expectation (<code>expect_*</code>) and the test (<code>test_*</code>) functions. By default, <code>threshold</code> is set to <code>1</code> which means that any single test unit failing will result in an overall failure (i.e., the expectation will fail).</p>
<p>As with the thresholds set in the <code><a href="../reference/action_levels.html">action_levels()</a></code> functions (or the shortcut functions <code><a href="../reference/action_levels.html">warn_on_fail()</a></code> and <code><a href="../reference/action_levels.html">stop_on_fail()</a></code>), whole numbers beyond <code>1</code> indicate that any failing units up to that absolute threshold value will result in a succeeding expectation. Likewise, fractional values (between <code>0</code> and <code>1</code>) act as a proportional failure threshold, where <code>0.25</code> means that 25% of failing test units results in a failed expectation.</p>
<p>The <code>preconditions</code> argument can be used to transform the input data before evaluation of the expectation. This is useful is some cases where you might need to summarize the input data table, mutate columns, perform some filtering, or even perform table joins beforehand.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Richard Iannone, Mauricio Vargas.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.9000.9000.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
