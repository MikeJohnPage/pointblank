<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Set action levels: failure thresholds and functions to invoke — action_levels • pointblank</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Set action levels: failure thresholds and functions to invoke — action_levels" />
<meta property="og:description" content="The action_levels() function works with the actions argument that is
present in the create_agent() function and in every validation step
function (which also has an actions argument). With it, we can provide
threshold fail levels for any combination of warn, stop, or notify
states.
We can react to any entrance of a state by supplying corresponding functions
to the fns argument. They will undergo evaluation at the time when the
matching state is entered. If provided to create_agent() then the policies
will be applied to every validation step, acting as a default for the
validation as a whole.
Calls of action_levels() could also be applied directly to any validation
step and this will act as an override if set also in create_agent(). Usage
of action_levels() is required to have any useful side effects (i.e.,
warnings, throwing errors) in the case of validation functions operating
directly on data (e.g., mtcars %&amp;gt;% col_vals_lt(&quot;mpg&quot;, 35)). There are two
helper functions that are convenient when using validation functions directly
on data (the agent-less workflow): warn_on_fail() and stop_on_fail().
These helpers either warn or stop (default failure threshold for each is set
to 1), and, they do so with informative warning or error messages. The
stop_on_fail() helper is applied by default when using validation functions
directly on data (more information on this is provided in Details).

" />
<meta property="og:image" content="/logo.svg" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pointblank</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Development version">0.7.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Validation Workflows</li>
    <li>
      <a href="../articles/validation_workflows.html">Overview</a>
    </li>
    <li>
      <a href="../articles/VALID-I.html">VALID-I: Data Quality Reporting</a>
    </li>
    <li>
      <a href="../articles/VALID-II.html">VALID-II: Pipeline Data Validation</a>
    </li>
    <li>
      <a href="../articles/VALID-III.html">VALID-III: Expectations in Unit Tests</a>
    </li>
    <li>
      <a href="../articles/VALID-IV.html">VALID-IV: Data Tests for Conditionals</a>
    </li>
    <li>
      <a href="../articles/VALID-V.html">VALID-V: Table Scan</a>
    </li>
    <li>
      <a href="../articles/VALID-VI.html">VALID-VI: R Markdown Document Validation</a>
    </li>
    <li class="dropdown-header">Information Management</li>
    <li>
      <a href="../articles/INFO-1.html">Intro to Information Management</a>
    </li>
    <li>
      <a href="../articles/INFO-2.html">Advanced Information Management</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rich-iannone/pointblank/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Set action levels: failure thresholds and functions to invoke</h1>
    <small class="dont-index">Source: <a href='https://github.com/rich-iannone/pointblank/blob/master/R/action_levels.R'><code>R/action_levels.R</code></a></small>
    <div class="hidden name"><code>action_levels.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The <code>action_levels()</code> function works with the <code>actions</code> argument that is
present in the <code><a href='create_agent.html'>create_agent()</a></code> function and in every validation step
function (which also has an <code>actions</code> argument). With it, we can provide
threshold <em>fail</em> levels for any combination of <code>warn</code>, <code>stop</code>, or <code>notify</code>
states.</p>
<p>We can react to any entrance of a state by supplying corresponding functions
to the <code>fns</code> argument. They will undergo evaluation at the time when the
matching state is entered. If provided to <code><a href='create_agent.html'>create_agent()</a></code> then the policies
will be applied to every validation step, acting as a default for the
validation as a whole.</p>
<p>Calls of <code>action_levels()</code> could also be applied directly to any validation
step and this will act as an override if set also in <code><a href='create_agent.html'>create_agent()</a></code>. Usage
of <code>action_levels()</code> is required to have any useful side effects (i.e.,
warnings, throwing errors) in the case of validation functions operating
directly on data (e.g., <code>mtcars %&gt;% col_vals_lt("mpg", 35)</code>). There are two
helper functions that are convenient when using validation functions directly
on data (the <code>agent</code>-less workflow): <code>warn_on_fail()</code> and <code>stop_on_fail()</code>.
These helpers either warn or stop (default failure threshold for each is set
to <code>1</code>), and, they do so with informative warning or error messages. The
<code>stop_on_fail()</code> helper is applied by default when using validation functions
directly on data (more information on this is provided in <em>Details</em>).</p>
<p><link rel="stylesheet" type="text/css" href="../doc/assets/extra.css"></p>
<p><script src="../doc/assets/rd.js"></script></p>
    </div>

    <pre class="usage"><span class='fu'>action_levels</span><span class='op'>(</span>warn_at <span class='op'>=</span> <span class='cn'>NULL</span>, stop_at <span class='op'>=</span> <span class='cn'>NULL</span>, notify_at <span class='op'>=</span> <span class='cn'>NULL</span>, fns <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>

<span class='fu'>warn_on_fail</span><span class='op'>(</span>warn_at <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='fu'>stop_on_fail</span><span class='op'>(</span>stop_at <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>warn_at, stop_at, notify_at</th>
      <td><p>The threshold number or fraction of
test units that can provide a <em>fail</em> result before entering the
<code>warn</code>, <code>stop</code>, or <code>notify</code> failure states. If this a decimal value between
<code>0</code> and <code>1</code> then it's a proportional failure threshold (e.g., <code>0.15</code>
indicates that if 15% percent of the test units are found to <em>fail</em>,
then the designated failure state is entered). Absolute values starting
from <code>1</code> can be used instead, and this constitutes an absolute failure
threshold (e.g., <code>10</code> means that if 10 of the test units are found to
<em>fail</em>, the failure state is entered).</p></td>
    </tr>
    <tr>
      <th>fns</th>
      <td><p>A named list of functions that is to be paired with the
appropriate failure states. The syntax for this list involves using failure
state names from the set of <code>warn</code>, <code>stop</code>, and <code>notify</code>. The functions
corresponding to the failure states are provided as formulas (e.g.,
<code><a href='https://rdrr.io/r/base/list.html'>list(warn = ~ warning("Too many failures."))</a></code>. A series of expressions for
each named state can be used by enclosing the set of statements with <code>{ }</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The output of the <code>action_levels()</code> call in <code>actions</code> will be interpreted
slightly differently if using an <em>agent</em> or using validation functions
directly on a data table. For convenience, when working directly on data, any
values supplied to <code>warn_at</code> or <code>stop_at</code> will be automatically given a stock
<code><a href='https://rdrr.io/r/base/warning.html'>warning()</a></code> or <code><a href='https://rdrr.io/r/base/stop.html'>stop()</a></code> function. For example using
<code>small_table %&gt;% col_is_integer("date")</code> will provide a detailed stop message
by default, indicating the reason for the failure. If you were to supply the
<code>fns</code> for <code>stop</code> or <code>warn</code> manually then the stock functions would be
overridden. Furthermore, if <code>actions</code> is NULL in this workflow (the default),
<strong>pointblank</strong> will use a <code>stop_at</code> value of <code>1</code> (providing a detailed,
context-specific error message if there are any <em>fail</em> units). We can
absolutely suppress this automatic stopping behavior by at each validation
step by setting <code>active = FALSE</code>. In this interactive data case, there is no
stock function given for <code>notify_at</code>. The <code>notify</code> failure state is less
commonly used in this workflow as it is in the <em>agent</em>-based one.</p>
<p>When using an <em>agent</em>, we often opt to not use any functions in <code>fns</code> as the
<code>warn</code>, <code>stop</code>, and <code>notify</code> failure states will be reported on when using
<code>create_agent_report()</code> (and, usually that's sufficient). Instead, using the
<code>end_fns</code> argument is a better choice since that scheme provides useful data
on the entire interrogation, allowing for finer control on side effects and
reducing potential for duplicating any side effects.</p>
    <h2 class="hasAnchor" id="function-id"><a class="anchor" href="#function-id"></a>Function ID</h2>

    

<p>1-5</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other Planning and Prep: 
<code><a href='create_agent.html'>create_agent</a>()</code>,
<code><a href='create_informant.html'>create_informant</a>()</code>,
<code><a href='db_tbl.html'>db_tbl</a>()</code>,
<code><a href='draft_validation.html'>draft_validation</a>()</code>,
<code><a href='file_tbl.html'>file_tbl</a>()</code>,
<code><a href='scan_data.html'>scan_data</a>()</code>,
<code><a href='tbl_get.html'>tbl_get</a>()</code>,
<code><a href='tbl_source.html'>tbl_source</a>()</code>,
<code><a href='tbl_store.html'>tbl_store</a>()</code>,
<code><a href='validate_rmd.html'>validate_rmd</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>

<span class='co'># For these examples, we will use the</span>
<span class='co'># included `small_table` dataset</span>
<span class='va'>small_table</span>

<span class='co'># Create an `action_levels` object</span>
<span class='co'># with fractional values for the</span>
<span class='co'># `warn`, `stop`, and `notify` states</span>
<span class='va'>al</span> <span class='op'>&lt;-</span> 
  <span class='fu'>action_levels</span><span class='op'>(</span>
    warn_at <span class='op'>=</span> <span class='fl'>0.2</span>,
    stop_at <span class='op'>=</span> <span class='fl'>0.8</span>,
    notify_at <span class='op'>=</span> <span class='fl'>0.5</span>
  <span class='op'>)</span>
  
<span class='co'># A summary of settings for the `al`</span>
<span class='co'># object is shown by printing it</span>
<span class='va'>al</span>

<span class='co'># Create a pointblank agent and</span>
<span class='co'># apply the `al` object to `actions`;</span>
<span class='co'># add two validation steps and</span>
<span class='co'># interrogate the `small_table`</span>
<span class='va'>agent_1</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='create_agent.html'>create_agent</a></span><span class='op'>(</span>
    tbl <span class='op'>=</span> <span class='va'>small_table</span>,
    actions <span class='op'>=</span> <span class='va'>al</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='col_vals_gt.html'>col_vals_gt</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>, value <span class='op'>=</span> <span class='fl'>2</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='col_vals_lt.html'>col_vals_lt</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span>, value <span class='op'>=</span> <span class='fl'>20000</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='interrogate.html'>interrogate</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># The report from the agent will show</span>
<span class='co'># that the `warn` state has been entered</span>
<span class='co'># for the first validation step but not</span>
<span class='co'># the second one; we can confirm this</span>
<span class='co'># in the console by inspecting the</span>
<span class='co'># `warn` component in the agent's x-list</span>
<span class='va'>x_list</span> <span class='op'>&lt;-</span> <span class='fu'><a href='get_agent_x_list.html'>get_agent_x_list</a></span><span class='op'>(</span><span class='va'>agent_1</span><span class='op'>)</span>
<span class='va'>x_list</span><span class='op'>$</span><span class='va'>warn</span>

<span class='co'># Applying the `action_levels` object</span>
<span class='co'># to the agent means that all validation</span>
<span class='co'># steps will inherit these settings but</span>
<span class='co'># we can override this by applying</span>
<span class='co'># another such object to the validation</span>
<span class='co'># step instead (this time using the</span>
<span class='co'># `warn_on_fail()` shorthand)</span>
<span class='va'>agent_2</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='create_agent.html'>create_agent</a></span><span class='op'>(</span>
    tbl <span class='op'>=</span> <span class='va'>small_table</span>,
    actions <span class='op'>=</span> <span class='va'>al</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='col_vals_gt.html'>col_vals_gt</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>, value <span class='op'>=</span> <span class='fl'>2</span>,
    actions <span class='op'>=</span> <span class='fu'>warn_on_fail</span><span class='op'>(</span>warn_at <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='col_vals_lt.html'>col_vals_lt</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span>, value <span class='op'>=</span> <span class='fl'>20000</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='interrogate.html'>interrogate</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='co'># In this case, the first validation</span>
<span class='co'># step has a less stringent failure</span>
<span class='co'># threshold for the `warn` state and it's</span>
<span class='co'># high enough that the condition is not</span>
<span class='co'># entered; this can be confirmed in the</span>
<span class='co'># console through inspection of the</span>
<span class='co'># x-list `warn` component</span>
<span class='va'>x_list</span> <span class='op'>&lt;-</span> <span class='fu'><a href='get_agent_x_list.html'>get_agent_x_list</a></span><span class='op'>(</span><span class='va'>agent_2</span><span class='op'>)</span>
<span class='va'>x_list</span><span class='op'>$</span><span class='va'>warn</span>

<span class='co'># In the context of using validation</span>
<span class='co'># functions directly on data (i.e., no</span>
<span class='co'># involvement of an agent) we want to</span>
<span class='co'># trigger warnings and raise errors; the</span>
<span class='co'># following will yield a warning if</span>
<span class='co'># it is executed (returning the</span>
<span class='co'># `small_table` data)</span>
<span class='va'>small_table</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='col_vals_gt.html'>col_vals_gt</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>, value <span class='op'>=</span> <span class='fl'>2</span>,
    actions <span class='op'>=</span> <span class='fu'>warn_on_fail</span><span class='op'>(</span>warn_at <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
  <span class='op'>)</span>

<span class='co'># With the same pipeline, not supplying</span>
<span class='co'># anything for `actions` (it's `NULL` by</span>
<span class='co'># default) will have the same effect as</span>
<span class='co'># using `stop_on_fail(stop_at = 1)` </span>
<span class='va'>small_table</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='col_vals_gt.html'>col_vals_gt</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>, value <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>

<span class='va'>small_table</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='col_vals_gt.html'>col_vals_gt</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>, value <span class='op'>=</span> <span class='fl'>2</span>,
    actions <span class='op'>=</span> <span class='fu'>stop_on_fail</span><span class='op'>(</span>stop_at <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
  <span class='op'>)</span>

<span class='co'># This is because the `stop_on_fail()`</span>
<span class='co'># call is auto-injected in the default</span>
<span class='co'># case (when operating on data) for your</span>
<span class='co'># convenience; behind the scenes a</span>
<span class='co'># 'secret agent' uses 'covert actions':</span>
<span class='co'># all so you can type less</span>

<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Richard Iannone, Mauricio Vargas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


