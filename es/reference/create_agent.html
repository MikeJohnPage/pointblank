<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create a pointblank agent object — create_agent • pointblank</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Create a pointblank agent object — create_agent" />
<meta property="og:description" content="The create_agent() function creates an agent object, which is used in a
data quality reporting workflow. The overall aim of this workflow is to
generate useful reporting information for assessing the level of data quality
for the target table. We can supply as many validation functions as the user
wishes to write, thereby increasing the level of validation coverage for that
table. The agent assigned by the create_agent() call takes validation
functions, which expand to validation steps (each one is numbered). This
process is known as developing a validation plan.
The validation functions, when called on an agent, are merely instructions
up to the point the interrogate() function is called. That kicks off the
process of the agent acting on the validation plan and getting results
for each step. Once the interrogation process is complete, we can say that
the agent has intel. Calling the agent itself will result in a reporting
table. This reporting of the interrogation can also be accessed with the
get_agent_report() function, where there are more reporting options." />
<meta property="og:image" content="/logo.svg" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pointblank</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Development version">0.9.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Validation Workflows</li>
    <li>
      <a href="../articles/validation_workflows.html">Overview</a>
    </li>
    <li>
      <a href="../articles/VALID-I.html">VALID-I: Data Quality Reporting</a>
    </li>
    <li>
      <a href="../articles/VALID-II.html">VALID-II: Pipeline Data Validation</a>
    </li>
    <li>
      <a href="../articles/VALID-III.html">VALID-III: Expectations in Unit Tests</a>
    </li>
    <li>
      <a href="../articles/VALID-IV.html">VALID-IV: Data Tests for Conditionals</a>
    </li>
    <li>
      <a href="../articles/VALID-V.html">VALID-V: Table Scan</a>
    </li>
    <li>
      <a href="../articles/VALID-VI.html">VALID-VI: R Markdown Document Validation</a>
    </li>
    <li class="dropdown-header">Information Management</li>
    <li>
      <a href="../articles/INFO-1.html">Intro to Information Management</a>
    </li>
    <li>
      <a href="../articles/INFO-2.html">Advanced Information Management</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rich-iannone/pointblank/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create a <strong>pointblank</strong> <em>agent</em> object</h1>
    <small class="dont-index">Source: <a href='https://github.com/rich-iannone/pointblank/blob/master/R/create_agent.R'><code>R/create_agent.R</code></a></small>
    <div class="hidden name"><code>create_agent.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The <code>create_agent()</code> function creates an <em>agent</em> object, which is used in a
<em>data quality reporting</em> workflow. The overall aim of this workflow is to
generate useful reporting information for assessing the level of data quality
for the target table. We can supply as many validation functions as the user
wishes to write, thereby increasing the level of validation coverage for that
table. The <em>agent</em> assigned by the <code>create_agent()</code> call takes validation
functions, which expand to validation steps (each one is numbered). This
process is known as developing a <em>validation plan</em>.</p>
<p>The validation functions, when called on an <em>agent</em>, are merely instructions
up to the point the <code><a href='interrogate.html'>interrogate()</a></code> function is called. That kicks off the
process of the <em>agent</em> acting on the <em>validation plan</em> and getting results
for each step. Once the interrogation process is complete, we can say that
the <em>agent</em> has intel. Calling the <em>agent</em> itself will result in a reporting
table. This reporting of the interrogation can also be accessed with the
<code><a href='get_agent_report.html'>get_agent_report()</a></code> function, where there are more reporting options.</p>
    </div>

    <pre class="usage"><span class='fu'>create_agent</span><span class='op'>(</span>
  tbl <span class='op'>=</span> <span class='cn'>NULL</span>,
  read_fn <span class='op'>=</span> <span class='cn'>NULL</span>,
  tbl_name <span class='op'>=</span> <span class='cn'>NULL</span>,
  label <span class='op'>=</span> <span class='cn'>NULL</span>,
  actions <span class='op'>=</span> <span class='cn'>NULL</span>,
  end_fns <span class='op'>=</span> <span class='cn'>NULL</span>,
  embed_report <span class='op'>=</span> <span class='cn'>FALSE</span>,
  lang <span class='op'>=</span> <span class='cn'>NULL</span>,
  locale <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>tbl</th>
      <td><p>The input table. This can be a data frame, a tibble, a <code>tbl_dbi</code>
object, or a <code>tbl_spark</code> object. Alternatively, a function can be used to
read in the input data table with the <code>read_fn</code> argument (in which case,
<code>tbl</code> can be <code>NULL</code>).</p></td>
    </tr>
    <tr>
      <th>read_fn</th>
      <td><p>A table-prep formula that's used to access the target table.
Even if a <code>tbl</code> is provided, this formula will be invoked to obtain the
data (i.e., the <code>read_fn</code> takes priority). There are two ways to specify a
<code>read_fn</code>: (1) with a right-hand side (RHS) formula expression (e.g.,
<code>~ { &lt;table reading code&gt;}</code>) or (2) as a function (e.g.,
<code>function() { &lt;table reading code&gt;}</code>).</p></td>
    </tr>
    <tr>
      <th>tbl_name</th>
      <td><p>A optional name to assign to the input table object. If no
value is provided, a name will be generated based on whatever information
is available. This table name will be displayed in the header area of the
agent report generated by printing the <em>agent</em> or calling
<code><a href='get_agent_report.html'>get_agent_report()</a></code>.</p></td>
    </tr>
    <tr>
      <th>label</th>
      <td><p>An optional label for the validation plan. If no value is
provided, a label will be generated based on the current system time.
Markdown can be used here to make the label more visually appealing (it
will appear in the header area of the agent report).</p></td>
    </tr>
    <tr>
      <th>actions</th>
      <td><p>A option to include a list with threshold levels so that all
validation steps can react accordingly when exceeding the set levels. This
is to be created with the <code><a href='action_levels.html'>action_levels()</a></code> helper function. Should an
action levels list be used for a specific validation step, the default set
specified here will be overridden.</p></td>
    </tr>
    <tr>
      <th>end_fns</th>
      <td><p>A list of expressions that should be invoked at the end of an
interrogation. Each expression should be in the form of a one-sided R
formula, so overall this construction should be used: <code>end_fns = list(~ &lt;R statements&gt;, ~ &lt;R statements&gt;, ...)</code>. An example of a function included in
<strong>pointblank</strong> that can be sensibly used here is <code><a href='email_blast.html'>email_blast()</a></code>, which
sends an email of the validation report (based on a sending condition).</p></td>
    </tr>
    <tr>
      <th>embed_report</th>
      <td><p>An option to embed a <strong>gt</strong>-based validation report into
the <code>ptblank_agent</code> object. If <code>FALSE</code> (the default) then the table object
will be not generated and available with the <em>agent</em> upon returning from
the interrogation.</p></td>
    </tr>
    <tr>
      <th>lang</th>
      <td><p>The language to use for automatic creation of briefs (short
descriptions for each validation step) and for the <em>agent report</em> (a
summary table that provides the validation plan and the results from the
interrogation. By default, <code>NULL</code> will create English (<code>"en"</code>) text. Other
options include French (<code>"fr"</code>), German (<code>"de"</code>), Italian (<code>"it"</code>), Spanish
(<code>"es"</code>), Portuguese (<code>"pt"</code>), Turkish (<code>"tr"</code>), Chinese (<code>"zh"</code>), Russian
(<code>"ru"</code>), Polish (<code>"pl"</code>), Danish (<code>"da"</code>), Swedish (<code>"sv"</code>), and Dutch
(<code>"nl"</code>).</p></td>
    </tr>
    <tr>
      <th>locale</th>
      <td><p>An optional locale ID to use for formatting values in the
<em>agent report</em> summary table according the locale's rules. Examples include
<code>"en_US"</code> for English (United States) and <code>"fr_FR"</code> for French (France);
more simply, this can be a language identifier without a country
designation, like "es" for Spanish (Spain, same as <code>"es_ES"</code>).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code>ptblank_agent</code> object.</p>
    <h2 class="hasAnchor" id="data-products-obtained-from-an-agent"><a class="anchor" href="#data-products-obtained-from-an-agent"></a>Data Products Obtained from an Agent</h2>

    

<p>A very detailed list object, known as an x-list, can be obtained by using the
<code><a href='get_agent_x_list.html'>get_agent_x_list()</a></code> function on the <em>agent</em>. This font of information can be
taken as a whole, or, broken down by the step number (with the <code>i</code> argument).</p>
<p>Sometimes it is useful to see which rows were the failing ones. By using the
<code><a href='get_data_extracts.html'>get_data_extracts()</a></code> function on the <em>agent</em>, we either get a list of
tibbles (for those steps that have data extracts) or one tibble if the
validation step is specified with the <code>i</code> argument.</p>
<p>The target data can be split into pieces that represent the 'pass' and 'fail'
portions with the <code><a href='get_sundered_data.html'>get_sundered_data()</a></code> function. A primary requirement is an
agent that has had <code><a href='interrogate.html'>interrogate()</a></code> called on it. In addition, the validation
steps considered for this data splitting need to be those that operate on
values down a column (e.g., the <code>col_vals_*()</code> functions or <code><a href='conjointly.html'>conjointly()</a></code>).
With these in-consideration validation steps, rows with no failing test units
across all validation steps comprise the 'pass' data piece, and rows with at
least one failing test unit across the same series of validations constitute
the 'fail' piece.</p>
<p>If we just need to know whether all validations completely passed (i.e., all
steps had no failing test units), the <code><a href='all_passed.html'>all_passed()</a></code> function could be used
on the <em>agent</em>. However, in practice, it's not often the case that all data
validation steps are free from any failing units.</p>
<p>While printing an <em>agent</em> will display the <em>agent</em> report in the Viewer, we
can alternatively use the <code><a href='get_agent_report.html'>get_agent_report()</a></code> to take advantage of other
options (e.g., overriding the language, modifying the arrangement of report
rows, etc.), and to return the report as independent objects. For example,
with the <code>display_table = TRUE</code> option (the default), <code><a href='get_agent_report.html'>get_agent_report()</a></code>
will return a <strong>gt</strong> table object (<code>"gt_tbl"</code>). If <code>display_table</code> is set to
<code>FALSE</code>, we'll get a data frame back instead.</p>
    <h2 class="hasAnchor" id="yaml"><a class="anchor" href="#yaml"></a>YAML</h2>

    

<p>A <strong>pointblank</strong> agent can be written to YAML with <code><a href='yaml_write.html'>yaml_write()</a></code> and the
resulting YAML can be used to regenerate an agent (with <code><a href='yaml_read_agent.html'>yaml_read_agent()</a></code>)
or interrogate the target table (via <code><a href='yaml_agent_interrogate.html'>yaml_agent_interrogate()</a></code>). Here is an
example of how a complex call of <code>create_agent()</code> is expressed in R code and
in the corresponding YAML representation.</p><pre># R statement
create_agent(
  read_fn = ~ small_table,
  tbl_name = "small_table",
  label = "An example.",
  actions = action_levels(
    warn_at = 0.10,
    stop_at = 0.25,
    notify_at = 0.35
  ), 
  end_fns = list(
    ~ beepr::beep(2),
    ~ Sys.sleep(1)
  ), 
  embed_report = TRUE,
  lang = "fr", 
  locale = "fr_CA"
)

# YAML representation
type: agent
read_fn: ~small_table
tbl_name: small_table
label: An example.
lang: fr
locale: fr_CA
actions:
  warn_fraction: 0.1
stop_fraction: 0.25
notify_fraction: 0.35
end_fns:
- ~beepr::beep(2)
- ~Sys.sleep(1)
embed_report: true
</pre>

<p>In practice, this block of YAML will be shorter since arguments with default
values won't be written to YAML when using <code><a href='yaml_write.html'>yaml_write()</a></code> (though it is
acceptable to include them with their default when generating the YAML by
other means). The only requirement for writing the YAML representation of an
<em>agent</em> is having <code>read_fn</code> specified (any table supplied to <code>tbl</code> is
ignored).</p>
<p>What typically follows this chunk of YAML is a <code>steps</code> part, and that
corresponds to the addition of validation steps via validation functions.
Help articles for each validation function have a <em>YAML</em> section that
describes how a given validation function is translated to YAML.</p>
<p>Should you need to preview the transformation of an <em>agent</em> to YAML (without
any committing anything to disk), use the <code><a href='yaml_agent_string.html'>yaml_agent_string()</a></code> function. If
you already have a <code>.yml</code> file that holds an <em>agent</em>, you can get a glimpse
of the R expressions that are used to regenerate that agent with
<code><a href='yaml_agent_show_exprs.html'>yaml_agent_show_exprs()</a></code>.</p>
    <h2 class="hasAnchor" id="writing-an-agent-to-disk"><a class="anchor" href="#writing-an-agent-to-disk"></a>Writing an Agent to Disk</h2>

    

<p>An <em>agent</em> object can be written to disk with the <code><a href='x_write_disk.html'>x_write_disk()</a></code> function.
This can be useful for keeping a history of validations and generating views
of data quality over time. Agents are stored in the serialized RDS format and
can be easily retrieved with the <code><a href='x_read_disk.html'>x_read_disk()</a></code> function.</p>
<p>It's recommended that table-prep formulas are supplied to the <code>read_fn</code>
argument of <code>create_agent()</code>. In this way, when an <em>agent</em> is read from disk
through <code><a href='x_read_disk.html'>x_read_disk()</a></code>, it can be reused to access the target table (which
may changed, hence the need to use an expression for this).</p>
    <h2 class="hasAnchor" id="combining-several-agents-in-a-multiagent-object"><a class="anchor" href="#combining-several-agents-in-a-multiagent-object"></a>Combining Several Agents in a <em>multiagent</em> Object</h2>

    

<p>Multiple <em>agent</em> objects can be part of a <em>multiagent</em> object, and two
functions can be used for this: <code><a href='create_multiagent.html'>create_multiagent()</a></code> and
<code><a href='read_disk_multiagent.html'>read_disk_multiagent()</a></code>. By gathering multiple agents that have performed
interrogations in the past, we can get a <em>multiagent</em> report showing how data
quality evolved over time. This use case is interesting for data quality
monitoring and management, and, the reporting (which can be customized with
<code><a href='get_multiagent_report.html'>get_multiagent_report()</a></code>) is robust against changes in validation steps for
a given target table.</p>
    <h2 class="hasAnchor" id="figures"><a class="anchor" href="#figures"></a>Figures</h2>

    

<p><img src='figures/man_create_agent_1.png' width=100% /></p>
    <h2 class="hasAnchor" id="function-id"><a class="anchor" href="#function-id"></a>Function ID</h2>

    

<p>1-2</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other Planning and Prep: 
<code><a href='action_levels.html'>action_levels</a>()</code>,
<code><a href='create_informant.html'>create_informant</a>()</code>,
<code><a href='db_tbl.html'>db_tbl</a>()</code>,
<code><a href='draft_validation.html'>draft_validation</a>()</code>,
<code><a href='file_tbl.html'>file_tbl</a>()</code>,
<code><a href='scan_data.html'>scan_data</a>()</code>,
<code><a href='tbl_get.html'>tbl_get</a>()</code>,
<code><a href='tbl_source.html'>tbl_source</a>()</code>,
<code><a href='tbl_store.html'>tbl_store</a>()</code>,
<code><a href='validate_rmd.html'>validate_rmd</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Let's walk through a data quality</span>
<span class='co'># analysis of an extremely small table;</span>
<span class='co'># it's actually called `small_table` and</span>
<span class='co'># we can find it as a dataset in this</span>
<span class='co'># package</span>
<span class='va'>small_table</span>
</div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 13 x 8</span>
#&gt;    date_time           date           a b             c      d e     f    
#&gt;    <span style='color: #949494; font-style: italic;'>&lt;dttm&gt;</span>              <span style='color: #949494; font-style: italic;'>&lt;date&gt;</span>     <span style='color: #949494; font-style: italic;'>&lt;int&gt;</span> <span style='color: #949494; font-style: italic;'>&lt;chr&gt;</span>     <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>  <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #949494; font-style: italic;'>&lt;lgl&gt;</span> <span style='color: #949494; font-style: italic;'>&lt;chr&gt;</span>
#&gt; <span style='color: #BCBCBC;'> 1</span> 2016-01-04 <span style='color: #949494;'>11:00:00</span> 2016-01-04     2 1-bcd-345     3  <span style='text-decoration: underline;'>3</span>423. TRUE  high 
#&gt; <span style='color: #BCBCBC;'> 2</span> 2016-01-04 <span style='color: #949494;'>00:32:00</span> 2016-01-04     3 5-egh-163     8 <span style='text-decoration: underline;'>10</span>000. TRUE  low  
#&gt; <span style='color: #BCBCBC;'> 3</span> 2016-01-05 <span style='color: #949494;'>13:32:00</span> 2016-01-05     6 8-kdg-938     3  <span style='text-decoration: underline;'>2</span>343. TRUE  high 
#&gt; <span style='color: #BCBCBC;'> 4</span> 2016-01-06 <span style='color: #949494;'>17:23:00</span> 2016-01-06     2 5-jdo-903    <span style='color: #BB0000;'>NA</span>  <span style='text-decoration: underline;'>3</span>892. FALSE mid  
#&gt; <span style='color: #BCBCBC;'> 5</span> 2016-01-09 <span style='color: #949494;'>12:36:00</span> 2016-01-09     8 3-ldm-038     7   284. TRUE  low  
#&gt; <span style='color: #BCBCBC;'> 6</span> 2016-01-11 <span style='color: #949494;'>06:15:00</span> 2016-01-11     4 2-dhe-923     4  <span style='text-decoration: underline;'>3</span>291. TRUE  mid  
#&gt; <span style='color: #BCBCBC;'> 7</span> 2016-01-15 <span style='color: #949494;'>18:46:00</span> 2016-01-15     7 1-knw-093     3   843. TRUE  high 
#&gt; <span style='color: #BCBCBC;'> 8</span> 2016-01-17 <span style='color: #949494;'>11:27:00</span> 2016-01-17     4 5-boe-639     2  <span style='text-decoration: underline;'>1</span>036. FALSE low  
#&gt; <span style='color: #BCBCBC;'> 9</span> 2016-01-20 <span style='color: #949494;'>04:30:00</span> 2016-01-20     3 5-bce-642     9   838. FALSE high 
#&gt; <span style='color: #BCBCBC;'>10</span> 2016-01-20 <span style='color: #949494;'>04:30:00</span> 2016-01-20     3 5-bce-642     9   838. FALSE high 
#&gt; <span style='color: #BCBCBC;'>11</span> 2016-01-26 <span style='color: #949494;'>20:07:00</span> 2016-01-26     4 2-dmx-010     7   834. TRUE  low  
#&gt; <span style='color: #BCBCBC;'>12</span> 2016-01-28 <span style='color: #949494;'>02:51:00</span> 2016-01-28     2 7-dmx-010     8   108. FALSE low  
#&gt; <span style='color: #BCBCBC;'>13</span> 2016-01-30 <span style='color: #949494;'>11:23:00</span> 2016-01-30     1 3-dka-303    <span style='color: #BB0000;'>NA</span>  <span style='text-decoration: underline;'>2</span>230. TRUE  high </div><div class='input'>
<span class='co'># We ought to think about what's</span>
<span class='co'># tolerable in terms of data quality so</span>
<span class='co'># let's designate proportional failure</span>
<span class='co'># thresholds to the `warn`, `stop`, and</span>
<span class='co'># `notify` states using `action_levels()`</span>
<span class='va'>al</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='action_levels.html'>action_levels</a></span><span class='op'>(</span>
      warn_at <span class='op'>=</span> <span class='fl'>0.10</span>,
      stop_at <span class='op'>=</span> <span class='fl'>0.25</span>,
    notify_at <span class='op'>=</span> <span class='fl'>0.35</span>
  <span class='op'>)</span>

<span class='co'># Now create a pointblank `agent` object</span>
<span class='co'># and give it the `al` object (which</span>
<span class='co'># serves as a default for all validation</span>
<span class='co'># steps which can be overridden); the</span>
<span class='co'># static thresholds provided by `al` will</span>
<span class='co'># make the reporting a bit more useful</span>
<span class='va'>agent</span> <span class='op'>&lt;-</span> 
  <span class='fu'>create_agent</span><span class='op'>(</span>
    read_fn <span class='op'>=</span> <span class='op'>~</span> <span class='va'>small_table</span>,
    tbl_name <span class='op'>=</span> <span class='st'>"small_table"</span>,
    label <span class='op'>=</span> <span class='st'>"An example."</span>,
    actions <span class='op'>=</span> <span class='va'>al</span>
  <span class='op'>)</span>

<span class='co'># Then, as with any `agent` object, we</span>
<span class='co'># can add steps to the validation plan by</span>
<span class='co'># using as many validation functions as we</span>
<span class='co'># want; then, we use `interrogate()` to</span>
<span class='co'># physically perform the validations and</span>
<span class='co'># gather intel</span>
<span class='va'>agent</span> <span class='op'>&lt;-</span>
  <span class='va'>agent</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='col_exists.html'>col_exists</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>date</span>, <span class='va'>date_time</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='col_vals_regex.html'>col_vals_regex</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>b</span><span class='op'>)</span>,
    regex <span class='op'>=</span> <span class='st'>"[0-9]-[a-z]{3}-[0-9]{3}"</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='rows_distinct.html'>rows_distinct</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='col_vals_gt.html'>col_vals_gt</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span>, value <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='col_vals_lte.html'>col_vals_lte</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>c</span><span class='op'>)</span>, value <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='col_vals_equal.html'>col_vals_equal</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span>, value <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span>,
    na_pass <span class='op'>=</span> <span class='cn'>TRUE</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='col_vals_between.html'>col_vals_between</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>c</span><span class='op'>)</span>,
    left <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>, right <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>)</span>,
    na_pass <span class='op'>=</span> <span class='cn'>TRUE</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='interrogate.html'>interrogate</a></span><span class='op'>(</span><span class='op'>)</span>
  
<span class='co'># Calling `agent` in the console</span>
<span class='co'># prints the agent's report; but we</span>
<span class='co'># can get a `gt_tbl` object directly</span>
<span class='co'># with `get_agent_report(agent)`</span>
<span class='va'>report</span> <span class='op'>&lt;-</span> <span class='fu'><a href='get_agent_report.html'>get_agent_report</a></span><span class='op'>(</span><span class='va'>agent</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span><span class='op'>(</span><span class='va'>report</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "ptblank_agent_report" "gt_tbl"               "list"                </div><div class='input'>
<span class='co'># What can you do with the report?</span>
<span class='co'># Print it from an R Markdown code</span>
<span class='co'># chunk, use it in a **blastula** email,</span>
<span class='co'># put it in a webpage, or further</span>
<span class='co'># modify it with the **gt** package</span>

<span class='co'># From the report we know that Step</span>
<span class='co'># 4 had two test units (rows, really)</span>
<span class='co'># that failed; we can see those rows</span>
<span class='co'># with `get_data_extracts()` </span>
<span class='va'>agent</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='get_data_extracts.html'>get_data_extracts</a></span><span class='op'>(</span>i <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 2 x 8</span>
#&gt;   date_time           date           a b             c     d e     f    
#&gt;   <span style='color: #949494; font-style: italic;'>&lt;dttm&gt;</span>              <span style='color: #949494; font-style: italic;'>&lt;date&gt;</span>     <span style='color: #949494; font-style: italic;'>&lt;int&gt;</span> <span style='color: #949494; font-style: italic;'>&lt;chr&gt;</span>     <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #949494; font-style: italic;'>&lt;lgl&gt;</span> <span style='color: #949494; font-style: italic;'>&lt;chr&gt;</span>
#&gt; <span style='color: #BCBCBC;'>1</span> 2016-01-20 <span style='color: #949494;'>04:30:00</span> 2016-01-20     3 5-bce-642     9  838. FALSE high 
#&gt; <span style='color: #BCBCBC;'>2</span> 2016-01-20 <span style='color: #949494;'>04:30:00</span> 2016-01-20     3 5-bce-642     9  838. FALSE high </div><div class='input'>
<span class='co'># We can get an x-list for the whole</span>
<span class='co'># validation (8 steps), or, just for</span>
<span class='co'># the 4th step with `get_agent_x_list()`</span>
<span class='va'>xl_step_4</span> <span class='op'>&lt;-</span>
  <span class='va'>agent</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='get_agent_x_list.html'>get_agent_x_list</a></span><span class='op'>(</span>i <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>
 
<span class='co'># And then we can peruse the different</span>
<span class='co'># parts of the list; let's get the</span>
<span class='co'># fraction of test units that failed</span>
<span class='va'>xl_step_4</span><span class='op'>$</span><span class='va'>f_failed</span>
</div><div class='output co'>#&gt; [1] 0.15385</div><div class='input'>
<span class='co'># Just printing the x-list will tell</span>
<span class='co'># us what's available therein</span>
<span class='va'>xl_step_4</span>
</div><div class='output co'>#&gt; <span class='message'>── The x-list for `small_table` ────────────────────────────────────── STEP 4 ──</span></div><div class='output co'>#&gt; <span class='message'><span style='color: #00BBBB;'>$time_start $time_end</span> (<span style='color: #BB0000;'>POSIXct [1]</span>)</span></div><div class='output co'>#&gt; <span class='message'><span style='color: #00BBBB;'>$label $tbl_name $tbl_src $tbl_src_details</span> (<span style='color: #BB0000;'>chr [1]</span>)</span></div><div class='output co'>#&gt; <span class='message'><span style='color: #00BBBB;'>$tbl</span> (<span style='color: #0000BB;'>spec_tbl_df</span>, <span style='color: #0000BB;'>tbl_df</span>, <span style='color: #0000BB;'>tbl</span>, and <span style='color: #0000BB;'>data.frame</span>)</span></div><div class='output co'>#&gt; <span class='message'><span style='color: #00BBBB;'>$col_names $col_types</span> (<span style='color: #BB0000;'>chr [8]</span>)</span></div><div class='output co'>#&gt; <span class='message'><span style='color: #00BBBB;'>$i $type $columns $values $label $briefs</span> (<span style='color: #00BB00;'>mixed [1]</span>)</span></div><div class='output co'>#&gt; <span class='message'><span style='color: #00BBBB;'>$eval_error $eval_warning</span> (<span style='color: #BBBB00;'>lgl [1]</span>)</span></div><div class='output co'>#&gt; <span class='message'><span style='color: #00BBBB;'>$capture_stack</span> (<span style='color: #FFAF00;'>list [1]</span>)</span></div><div class='output co'>#&gt; <span class='message'><span style='color: #00BBBB;'>$n $n_passed $n_failed $f_passed $f_failed</span> (<span style='color: #00BB00;'>num [1]</span>)</span></div><div class='output co'>#&gt; <span class='message'><span style='color: #00BBBB;'>$warn $stop $notify</span> (<span style='color: #BBBB00;'>lgl [1]</span>)</span></div><div class='output co'>#&gt; <span class='message'><span style='color: #00BBBB;'>$lang</span> (<span style='color: #BB0000;'>chr [1]</span>)</span></div><div class='output co'>#&gt; <span class='message'>────────────────────────────────────────────────────────────────────────────────</span></div><div class='input'>
<span class='co'># An x-list not specific to any step</span>
<span class='co'># will have way more information and a</span>
<span class='co'># slightly different structure; see</span>
<span class='co'># `help(get_agent_x_list)` for more info</span>
<span class='co'># get_agent_x_list(agent)</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Richard Iannone, Mauricio Vargas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


